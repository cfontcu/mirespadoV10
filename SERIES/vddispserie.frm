###################################################################
#MOdulo: VDDISPSERIE.FRM
#Funcionalidad : Cálculo de disponibilidad de Series de Preparación
#Autor: FPD      
#Fecha: 08-04-2008
###################################################################
# HistOrico de cambios:
# 12-10-2018 Cambiar el nombre del fichero de log. Xavi.
BEGINBLOQUE=VDLANZASERIE.PAN
 PREREGISTRO=PRESEHIJO
 PREQUERY=QUERYHIJO
 REGPAG=6
 POSX=1
 POSY=1
 WHERE=STATUS < VDST.FSPRLANZADA;
 TITULO= CALCULO DE DISPONIBILIDAD

 CAMPO=ESTADO,AUXILIAR,OCULTO,"#L#"
                   
                                       
 TECLA=SF8,FEJECUTA("CDAMESEMAFORO","ERROR EN PLSQL CDAMESEMAFORO",
                    "CERRORSEMAFORO","SEMAFORO 'DISPONIBILIDAD' OCUPADO",                  
                    FCOMMIT,"",   
                    FLANZATAREASSYNC("-TDISPONIBILIDAD","Disponibilidad.log -WVDISPONIBILIDAD","2","0"),":V10ERROR",
                    "CRESETSERIES","ERROR EN CRESETSERIES",
                    "CSERIESCALCULADAS","ERROR EN CSERIESCALCULADAS",                    
                    "CLIBERASEMAFORO","ERROR AL LIBERAR SEMAFORO",
                    FCOMMIT,"",
                    FPULSATECLAS("F3","F2"))
                    
 ONLINE={F4} Lanzar Serie   {May+F8} Calcular Disponibilidad de Series;
 CAMPO=CODAGE,AUXILIAR,OCULTO,"__________"
 
 CURSOR=CERRORSEMAFORO Select :ESTADO FROM DUAL WHERE :ESTADO=0;
 
 CURSOR=CDAMESEMAFORO    BEGIN 
                          :ESTADO:=0;                
                          :ESTADO:=VDSEM.DAMESEMAFORO('DISPONIBILIDAD','N');
                        END;@
                       
CURSOR=CLIBERASEMAFORO BEGIN
                         VDSEM.LIBERASEMAFORO('DISPONIBILIDAD');
                       END;@     

 CURSOR=CRESETSERIES UPDATE VDSERIEPREP SET STATUS=VDST.FSPRCREADA,CODOPEMODIF='DISPONIBILIDAD',FECMODIF=VD.FECHASYS,HORAMODIF=VD.HORASYS 
                              WHERE STATUS IN (VDST.FSPRCREADA, VDST.FSPRCONDISPONI);
 
 CURSOR=CSERIESCALCULADAS UPDATE VDSERIEPREP SPR SET STATUS=VDST.FSPRCONDISPONI,CODOPEMODIF='DISPONIBILIDAD',FECMODIF=VD.FECHASYS,HORAMODIF=VD.HORASYS 
                              WHERE EXISTS (Select 1 FROM VDPEDIDOCAB PEC WHERE PEC.CODSERIEPREP=SPR.CODSERIEPREP And STATUS+0=VDST.FPECPDTELANZAR);
                             
  
 
ENDBLOQUE

BEGINBLOQUE=VDPEDIDOSSERIE.PAN
 PREREGISTRO=PRESEHIJO
 WHERE= STATUS = VDST.FPECENSERIE;
 PADRE=VDLANZASERIE.PAN
 POSY=14
 REGPAG=12 
 TITULO= PEDIDOS DE LA SERIE NO LANZABLES POR FALTAS Y BACKORDER
ENDBLOQUE

BEGINBLOQUE=VDPEDIDOSSERIE.PAN
 PREREGISTRO=PRESEHIJO
 WHERE= STATUS = VDST.FPECPDTELANZAR;
 PADRE=VDLANZASERIE.PAN
 POSY=31
 REGPAG=10
 TITULO= PEDIDOS DE LA SERIE LANZABLES 
ENDBLOQUE

BEGINBLOQUE=VDFALTAS.PAN
PREREGISTRO=PRESEHIJO
 PADRE=VDLANZASERIE.PAN
 POSY=46
 REGPAG=10
ENDBLOQUE

BEGINBLOQUE=VDFALTASSERIE.PAN
PREREGISTRO=PRESEHIJO
 PADRE=VDLANZASERIE.PAN
 POSY=46
 POSX=66
 REGPAG=10
ENDBLOQUE



