# MOdulo   : VDETIQCNT.FRM
# Función  : ImpresiOn de etiquetas de matrícula
#
# Creación : 13-08-2008
# Autor    : JCSR
###########################################
# HistOrico de cambios:
CAMPO=SID, AUXILIAR, OCULTO,"@L@@@"
CAMPO=SERIAL, AUXILIAR, OCULTO, "@L@@@@"
CAMPO=TERMINAL, AUXILIAR, OCULTO, "__________________"

PREFORM=FEJECUTA("CDAMESID", "ERROR AVERIGUANDO SID", "CDELANTIGUO", "NO PUEDO BORRAR ENTRADAS ANTERIORES", FCOMMIT,"")
#PREFORM=FEJECUTA("CDAMESID", "ERROR AVERIGUANDO SID", FCOMMIT,"")


BEGINBLOQUE=VDETIQCNT.PAN
NOORAINS
NOQUERY
  POSX=1
  POSY=1
  CAMPO=SID, AUXILIAR, VIRTUAL,OCULTO
  CAMPO=SERIAL, AUXILIAR, VIRTUAL,OCULTO
  CAMPO=TERMINAL, AUXILIAR, VIRTUAL,OCULTO

  CURSOR=CDAMESID BEGIN 
                    VD.DAMESID (:SID, :SERIAL, :TERMINAL);
                  END;@

  CURSOR=CDELANTIGUO DELETE FROM VDCRETIQUETAS WHERE SID=:SID AND SERIAL=:SERIAL;

  AYUDA= IMPRESION DE ETIQUETAS DE CONTENEDOR
  TECLA=SF9,FEJECUTAFORM("VDCRETIQUETAS","S","SID=:SID AND SERIAL=:SERIAL","","")
ENDBLOQUE   

BEGINBLOQUE=VDETIQPICK.PAN
NOORAINS
NOQUERY
  POSX=70
  POSY=1
  CAMPO=SID, AUXILIAR, VIRTUAL,OCULTO
  CAMPO=SERIAL, AUXILIAR, VIRTUAL,OCULTO
  CAMPO=TERMINAL, AUXILIAR, VIRTUAL,OCULTO

  CURSOR=CDAMESID BEGIN 
                    VD.DAMESID (:SID, :SERIAL, :TERMINAL);
                  END;@

  CURSOR=CDELANTIGUO DELETE FROM VDCRETIQUETAS WHERE SID=:SID AND SERIAL=:SERIAL;

  AYUDA= IMPRESION DE ETIQUETAS DE CONTENEDOR
  TECLA=SF9,FEJECUTAFORM("VDCRETIQUETAS","S","SID=:SID AND SERIAL=:SERIAL","","")
ENDBLOQUE    

BEGINBLOQUE=VDCONTE.PAN
  TITULO=DATOS DE LA MATRICULA EXISTENTE A IMPRIMIR
  PREREGISTRO=PRESEHIJO
  REGPAG=23
  TQUERY
  POSY=8
  NOINSERT
  NOUPDATE
  NODELETE
  CAMPO=SID, AUXILIAR, VIRTUAL,OCULTO
  CAMPO=SERIAL, AUXILIAR, VIRTUAL,OCULTO
  CAMPO=TERMINAL, AUXILIAR, VIRTUAL,OCULTO

  CURSOR=CDELANTIGUO DELETE FROM VDCRETIQUETAS WHERE SID=:SID AND SERIAL=:SERIAL;
  CURSOR=CINSERTADATO INSERT INTO VDCRETIQUETAS (DATO, COPIA, SID, SERIAL) VALUES  (:CODMAT, 'N', :SID, :SERIAL);

  POSTQUERY=FMODIFICA

  PREUPDATE=FEJECUTA("CINSERTADATO", "No puedo insertar dato.", FCOMMIT, "")
                   
  POSTCOMMIT=FEJECUTA(%FFAILURE,"INSERCION REALIZADA")
                        
  TECLA=SF4, FEJECUTA(FIMPRIME("INFORME","VDETICONTE.RPT","FORMSID=:SID;FORMSERIAL=:SERIAL",""),":V10ERROR",
                    %FFAILURE,"IMPRESION LANZADA","CDELANTIGUO", "NO PUEDO BORRAR ENTRADAS", FCOMMIT, "")

  AYUDA= IMPRESION DE ETIQUETAS DE CONTENEDOR

  ONLINE={F3} Limpiar datos  {F4} Insertar etiqueta para imprimir {May-F4} Lanzar impresiOn  {Shift+F7} Reimprimir 1 etiqueta;

ENDBLOQUE
BEGINBLOQUE=VDSTOCK.PAN
  PREQUERY=QUERYHIJO
  TITULO=STOCK DE LA MATRICULA EXISTENTE A IMPRIMIR
  PADRE=VDCONTE.PAN
  POSY=34
  REGPAG=20
  NOENTER
ENDBLOQUE  